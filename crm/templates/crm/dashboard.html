{% extends "base.html" %}
{% load static %}

{% block content %}

<section id="CRM">
    <div 
        x-data="{ tab: 'overview' }"
        class="w-full bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen"
        style="padding-top:8vh;"
    >
        <div class="section-wrapper px-10 py-10 md:px-20 pb-32">

            <!-- Header -->
            <div class="CRMheader">
                <h1 class="text-5xl font-bold text-gray-900 mb-2">CRM Dashboard</h1>
                <p class="text-gray-500 text-lg">Business analytics and insights</p>
            </div>

            <!-- Navigation Tabs -->
            <nav class="flex gap-6 border-b border-gray-300 bg-white px-8 rounded-2xl shadow-sm mb-28">
                <button
                    @click="tab = 'overview'"
                    :class="tab === 'overview' ? 'border-b-2 border-teal-600 text-teal-600 font-bold' : 'text-gray-400'"
                    class="pb-5 pt-5 text-base tracking-wide transition-all hover:text-teal-500"
                >
                    <i class="fas fa-chart-line mr-2"></i>
                    Overview
                </button>

                <button
                    @click="tab = 'sales'"
                    :class="tab === 'sales' ? 'border-b-2 border-teal-600 text-teal-600 font-bold' : 'text-gray-400'"
                    class="pb-5 pt-5 text-base tracking-wide transition-all hover:text-teal-500"
                >
                    <i class="fas fa-chart-bar mr-2"></i>
                    Sales
                </button>

                <button
                    @click="tab = 'products'"
                    :class="tab === 'products' ? 'border-b-2 border-teal-600 text-teal-600 font-bold' : 'text-gray-400'"
                    class="pb-5 pt-5 text-base tracking-wide transition-all hover:text-teal-500"
                >
                    <i class="fas fa-box mr-2"></i>
                    Products
                </button>

                <button
                    @click="tab = 'customers'"
                    :class="tab === 'customers' ? 'border-b-2 border-teal-600 text-teal-600 font-bold' : 'text-gray-400'"
                    class="pb-5 pt-5 text-base tracking-wide transition-all hover:text-teal-500"
                >
                    <i class="fas fa-users mr-2"></i>
                    Customers
                </button>
            </nav>
            <!-- OVERVIEW TAB -->
            <section
                x-show="tab === 'overview'"
                x-cloak
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 translate-y-4"
                x-transition:enter-end="opacity-100 translate-y-0"
            >
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 px-16 md:px-28">
                    <!-- Total Revenue -->
                    <div class="stat-card">
                        <div class="flex items-start justify-between mb-4">
                            <div class="bg-green-100 p-4 rounded-xl">
                                <i class="fas fa-dollar-sign text-green-600 text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-2">Total Revenue</p>
                        <h3 class="text-4xl font-bold text-gray-900">R$ {{ total_revenue|floatformat:2 }}</h3>
                    </div>

                    <!-- Total Orders -->
                    <div class="stat-card">
                        <div class="flex items-start justify-between mb-4">
                            <div class="bg-blue-100 p-4 rounded-xl">
                                <i class="fas fa-shopping-cart text-blue-600 text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-2">Total Orders</p>
                        <h3 class="text-4xl font-bold text-gray-900">{{ total_orders }}</h3>
                    </div>

                    <!-- Average Ticket -->
                    <div class="stat-card">
                        <div class="flex items-start justify-between mb-4">
                            <div class="bg-purple-100 p-4 rounded-xl">
                                <i class="fas fa-ticket-alt text-purple-600 text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-2">Average Ticket</p>
                        <h3 class="text-4xl font-bold text-gray-900">R$ {{ average_ticket|floatformat:2 }}</h3>
                    </div>

                    <!-- Total Customers -->
                    <div class="stat-card">
                        <div class="flex items-start justify-between mb-4">
                            <div class="bg-orange-100 p-4 rounded-xl">
                                <i class="fas fa-users text-orange-600 text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-2">Total Customers</p>
                        <h3 class="text-4xl font-bold text-gray-900">{{ total_customers }}</h3>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" style="margin-bottom: 40px;">
                    <!-- Revenue Chart -->
                    <div class="chart-container" style="padding: 32px; min-height: 450px;">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Monthly Revenue</h3>
                                <p class="text-gray-500 text-sm mt-1">Last 6 months performance</p>
                            </div>
                        </div>
                        <div style="height: 320px; position: relative;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <!-- Orders Chart -->
                    <div class="chart-container" style="padding: 32px; min-height: 450px;">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Orders Status</h3>
                                <p class="text-gray-500 text-sm mt-1">Current orders distribution</p>
                            </div>
                        </div>
                        <div style="height: 320px; position: relative;">
                            <canvas id="ordersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" style="margin-bottom: 60px;">
                    <!-- Top Products Chart -->
                    <div class="chart-container" style="padding: 32px; min-height: 450px;">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Top Products</h3>
                                <p class="text-gray-500 text-sm mt-1">Best selling items</p>
                            </div>
                        </div>
                        <div style="height: 320px; position: relative;">
                            <canvas id="productsChart"></canvas>
                        </div>
                    </div>

                    <!-- Sales Trend -->
                    <div class="chart-container" style="padding: 32px; min-height: 450px;">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Sales Trend</h3>
                                <p class="text-gray-500 text-sm mt-1">Last 7 days</p>
                            </div>
                        </div>
                        <div style="height: 320px; position: relative;">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SALES TAB -->
            <section
                x-show="tab === 'sales'"
                x-cloak
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 translate-y-4"
                x-transition:enter-end="opacity-100 translate-y-0"
            >
                <div class="mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-3">Sales Data</h1>
                    <p class="text-gray-500 text-lg">Detailed sales performance indicators</p>
                </div>
                
                <div class="chart-container">
                    <div style="height: 500px;">
                        <canvas id="salesDetailChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- PRODUCTS TAB -->
            <section
                x-show="tab === 'products'"
                x-cloak
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 translate-y-4"
                x-transition:enter-end="opacity-100 translate-y-0"
            >
                <div class="mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-3">Products</h1>
                    <p class="text-gray-500 text-lg">Product performance and inventory</p>
                </div>
                
                <div class="chart-container">
                    <div style="height: 500px;">
                        <canvas id="productsDetailChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- CUSTOMERS TAB -->
            <section
                x-show="tab === 'customers'"
                x-cloak
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 translate-y-4"
                x-transition:enter-end="opacity-100 translate-y-0"
            >
                <div class="mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-3">Customers</h1>
                    <p class="text-gray-500 text-lg">Customer behavior and analysis</p>
                </div>
                
                <div class="chart-container">
                    <div style="height: 500px;">
                        <canvas id="customersChart"></canvas>
                    </div>
                </div>
            </section>

        </div>
    </div>
</section>

<script>
// Dados de exemplo (Hard Coded -- Depois adicionar informacoes from django-models)
const revenueData = {
    labels: {{ revenue_labels|safe }},
    datasets: [{
        label: 'Revenue (R$)',
        data: {{ revenue_data|safe }},
        backgroundColor: 'rgba(8, 129, 120, 0.1)',
        borderColor: 'rgba(8, 129, 120, 1)',
        borderWidth: 3,
        tension: 0.4,
        fill: true,
        pointBackgroundColor: 'rgba(8, 129, 120, 1)',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointRadius: 5,
        pointHoverRadius: 7
    }]
};

const ordersData = {
    labels: {{ orders_labels|safe }},
    datasets: [{
        data: {{ orders_data|safe }},
        backgroundColor: [
            'rgba(59, 130, 246, 0.9)',
            'rgba(251, 191, 36, 0.9)',
            'rgba(34, 197, 94, 0.9)',
            'rgba(239, 68, 68, 0.9)'
        ],
        borderWidth: 0,
        hoverOffset: 15
    }]
};

const productsData = {
    labels: ['White T-Shirt', 'Black Hoodie', 'Blue Jeans', 'Red Cap', 'Sneakers'],
    datasets: [{
        label: 'Units Sold',
        data: [65, 59, 80, 81, 56],
        backgroundColor: 'rgba(168, 85, 247, 0.8)',
        borderColor: 'rgba(168, 85, 247, 1)',
        borderWidth: 0,
        borderRadius: 8
    }]
};

const trendData = {
    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    datasets: [{
        label: 'Sales',
        data: [12, 19, 3, 5, 2, 3, 15],
        backgroundColor: 'rgba(8, 129, 120, 0.2)',
        borderColor: 'rgba(8, 129, 120, 1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: 'rgba(8, 129, 120, 1)',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointRadius: 5
    }]
};

// Configuração global
Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
Chart.defaults.color = '#64748b';

// Revenue Chart (Line)
const ctxRevenue = document.getElementById('revenueChart').getContext('2d');
new Chart(ctxRevenue, {
    type: 'line',
    data: revenueData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
            padding: {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                cornerRadius: 8
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: '#f1f5f9', drawBorder: false },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            },
            x: {
                grid: { display: false },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            }
        }
    }
});

// Orders Chart (Doughnut)
const ctxOrders = document.getElementById('ordersChart').getContext('2d');
new Chart(ctxOrders, {
    type: 'doughnut',
    data: ordersData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
            padding: {
                top: 20,
                right: 20,
                bottom: 20,
                left: 20
            }
        },
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: { size: 12 },
                    usePointStyle: true,
                    pointStyle: 'circle'
                }
            }
        },
        cutout: '70%'
    }
});

// Products Chart (Bar)
const ctxProducts = document.getElementById('productsChart').getContext('2d');
new Chart(ctxProducts, {
    type: 'bar',
    data: productsData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
            padding: {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
        },
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: '#f1f5f9' },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            },
            x: { 
                grid: { display: false },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            }
        }
    }
});

// Trend Chart (Area)
const ctxTrend = document.getElementById('trendChart').getContext('2d');
new Chart(ctxTrend, {
    type: 'line',
    data: trendData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
            padding: {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
        },
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: '#f1f5f9' },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            },
            x: { 
                grid: { display: false },
                ticks: { 
                    padding: 8,
                    font: { size: 11 }
                }
            }
        }
    }
});
</script>

{% endblock %}